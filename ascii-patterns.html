<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="mnemonic@386dx25.de">
<style>
body {
  font-family: monospace;
  font-size: 14pt;
}
textarea {
  font-size: 14pt;
  resize: none;
}
code {
  position: absolute;
  top: 0;
  left: 0;
  white-space: pre;
  overflow: hidden;
  width: 100%;
  height: 100%;
  z-index: -1;
}
#controls {
  position: absolute; 
  right: 1em; 
  bottom: 0;
  background-color: cyan;
}
</style>
</head>
<body>
<textarea id="pattern" name="pattern" rows="4" cols="8">
</textarea>
<p id="controls"><a href="#" id="download">download</a></p>
<div>
<code id="wallpaper">
</code>
</div>
<script>
function writeTapestry(pattern, columns=80, rows=25) {
  var lines = pattern.split("\n").filter(Boolean);

  if(lines.length <= 0)
    return;

  const maxLineLength = lines.map((line) => line.length).reduce((accu, value) => Math.max(accu, value), 0);
  lines = lines.map((line) => line + " ".repeat(maxLineLength - line.length));

  const N = Math.floor(columns / lines[0].length);

  let text = "";
  for(let row=0; row < rows; ++row) {
    for(let n=0; n < N; ++n) {
      text += lines[row % lines.length];
    }
    text += "\n";
  }

  return text;
}

function updateDownloadLink(text, filename="tapestry.txt") {
  var element = document.getElementById("download"); //document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);
}

pattern.addEventListener("input", (event) => {  
  const pattern = document.getElementById("pattern");
  const wallpaper = document.getElementById("wallpaper");
  wallpaper.innerHTML = writeTapestry(pattern.value, 180, 60);
  updateDownloadLink(pattern.value + "\n" + writeTapestry(pattern.value));
});
</script>
</body>
</html>